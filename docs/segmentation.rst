2. Сегментация
==============

2.1. Что это такое и с чем это есть
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Для обучения полноценного ИИ не хватает 1000 изображений, а вручную маркировать 6000-7000 слишком сложно. Поэтому дальнейшая обработка будет производиться с помощью модели.

Мы создадим и обучим ее в Google Colab. Код лежит в "Segmentation.ipynb".

Скопируйте google colab на свой google drive. Создайте аналогичную структуру в корневой папке google drive:

.. figure:: pictures/Дерево_1.png
       :scale: 100 %
       :align: center
       :alt: alternate text

       Структура файлов

Загрузите кадры вашего набора данных в папку: **VisionProject/Dataset/Data/** Затем загрузите файл **"Labels.json"**, который у вас был после предыдущих шагов. **"NewLabels"** может быть копией **"Labels"**.

Эта структура используется исключительно для удобства использования google colab.

.. tip:: Вы можете использовать свою собственную структуру, если хотите, но вам придется изменить **пути к файлам**.


2.2. Обучение модели (сегментация)
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Если вы правильно выполнили предыдущие шаги, вам остается только запускать блоки кода один за другим.

в этом блоке на за будьте дать разрешение
вставит лс

Если что-то пошло не так, обращайтесь вот сюда:

Обучение может длится порядка **3-6 часов**, в зависимости от стабильности интернета и объема исходного датасета.

.. attention:: На протяжение всего времени обучения вам необходимо быть непосредственно вблизи работающего колаба, так как во избежания использования ботами, при длительном бездействии пользователя колаб просит **пройти капчу**. Если вы не успеваете среагировать, весь прогресс **сбрасывается**.
.. tip:: В случае появления проблем, проверьте файловые пути.


2.3 Разметка новых кадров
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~


Итак, загрузите видео в папку **VisionProject/Videos/** и внесите названия в блок.

**Пример**
Для видео с названием *video1* строка кода, отвечающая за подключение будет выглядеть как:
::

    get_frames('/content/drive/MyDrive/VisionProject/Videos/video1.mp4', './videos/')

Далее продолжаем последовательно выполнять блоки.

.. attention:: Разметка может длится несколько часов, и вам так же необходимо следить за работой колаба.

2.4 Получение готового датасета
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
По окончании выполнения всех блоков неархивированный полученный датасет будет загружен в папку **NewDataset/Data**, архивиованный: **NewDataset/dataset.zip**, аннотации к нему будут лежать в файле **NewLabels**.


2.5 Чистка данных
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Полученный датасет и аннотации к нему следует скачать, открыть в RemoApp и просмотреть на предмет неправильной или неточной разметки. Неподходящие по стандартам фото следует удалять или переразмечать вручную. Пример правильно размеченного маркера есть в разделе :ref:`wellmarked`.
